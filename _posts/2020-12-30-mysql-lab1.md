---
layout: post
title:  "Mysql Lab1"
date:   2020-12-28 22:20:01 +0800
categories: [Tech]
tag: 
  - MySql
  - 数据库
---

# selete for update

## 8.0

### REPEATABLE-READ

1. 通过主键（主键有唯一性）找到数据时（非范围查找），对相应的行加行级写锁。当前事务未提交时，其他事务是不能使用非索引列来更新数据，读取数据和删除数据。

2. 通过主键没有找到数据时，会锁住相应的 where 条件，相应位置不能插入数据。

3. 通过主键查找指定范围的数据时（无论相应范围内是否有数据），对相应范围加行级写锁和间隙锁。例如，一个 `products` 表中只有 `id = 3, id = 5, id = 8(id 是 primary key)` 的数据，使用 `select * FROM products where id < 5 FOR UPDATE `进行加锁，实际的锁是在 `id < 5` 找到的所有行加行级写锁，并且在 `id < 5` 上加间隙锁。当前事务未提交时，其他事务是不能使用非索引列来更新数据，读取数据和删除数据。

4. 通过非唯一索引查找到数据时，对相应行加行级写锁。数据库是可以做插入数据的操作的，但是每次插入操作时，主键列必须指定值（即使主键列是自增列），而且能使用索引进行更新，读取和删除未被上锁的数据。当前事务未提交时，其他事务是不能使用非索引列来更新数据，读取数据和删除数据。

5. 通过非唯一索引没有找到数据时，插入数据时主键列也必须指定值（即使主键列是自增列），其他操作都是可以的，同样也会锁住相应的 where 条件。

6. 通过非索引列查找数据时，无论有没有找到数据，都是对全表加写锁。

### READ-UNCOMMITTED

1. 通过主键找到指定行（非范围查找）的数据时，对相应的行加行级写锁。

2. 通过主键（主键有唯一性）没有找到指定行（非范围查找）数据时，不加任何锁，相应位置可以插入数据。

3. 通过主键范围查找数据时，如果没有找到，则不加任何锁，相应范围可以插入数据。如果找到数据，则给相应的行就行级写锁，相应范围可以插入数据。

4. 通过非唯一索引查找到数据时，对相应行加行级写锁。表可以在未上锁行上进行操作，包括插入新数据，即使新数据包含和 where 提交同样的值。

5. 通过非唯一索引没有找到数据时，不加如何锁。

6. 通过非索引列查找数据时。有数据时，给相应行上行级写锁。没有数据时，不加任何锁。

# delete, truncate, drop

delete 不会释放空间，相当于逻辑删除

truncate 会释放空间，相当于物理删除
